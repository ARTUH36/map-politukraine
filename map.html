<!DOCTYPE html>
<html>
<head>
  <title>–ö–∞—Ä—Ç–∞ –∑ –∑–æ–Ω–∞–º–∏ –æ–∫—É–ø–∞—Ü—ñ—ó</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
  <style>
    #map { width: 100%; height: 600px; }
    #buttons { margin: 10px; }
    button { padding: 5px 10px; margin-right: 10px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="buttons">
    <button id="save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ GeoJSON —É —Ñ–∞–π–ª</button>
    <button id="edit">‚úèÔ∏è –í–∫–ª—é—á–∏—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
  <script>
    var imageWidth = 2000;
    var imageHeight = 1500;

    var map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 2,
      zoomControl: true,
    });

    var bounds = [[0, 0], [imageHeight, imageWidth]];
    var image = L.imageOverlay('your_image.png', bounds).addTo(map);
    map.fitBounds(bounds);

    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    var drawControl = new L.Control.Draw({
      draw: {
        polyline: false,
        rectangle: false,
        circle: false,
        marker: false,
        circlemarker: false,
        polygon: {
          allowIntersection: false,
          showArea: true,
          shapeOptions: {
            color: '#0077ff',
            fillOpacity: 0.4
          }
        }
      },
      edit: {
        featureGroup: drawnItems,
        edit: true,
        remove: true
      }
    });
    map.addControl(drawControl);

    map.on(L.Draw.Event.CREATED, function (e) {
      var layer = e.layer;
      var zoneName = prompt("–í–≤–µ–¥–∏ –Ω–∞–∑–≤—É –∑–æ–Ω–∏:");
      var occupier = prompt("–•—Ç–æ –æ–∫—É–ø—É–≤–∞–≤ —Ü—é –∑–æ–Ω—É?");
      if (!zoneName || !occupier) return;

      layer.feature = {
        type: "Feature",
        properties: {
          name: zoneName,
          occupier: occupier
        }
      };

      layer.bindPopup("üó∫Ô∏è <b>" + zoneName + "</b><br>üö© –û–∫—É–ø–∞–Ω—Ç: <b>" + occupier + "</b>");
      drawnItems.addLayer(layer);
    });

    // –†–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    document.getElementById('edit').onclick = function() {
      new L.EditToolbar.Edit(map, {
        featureGroup: drawnItems
      }).enable();
    };

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ JSON —É —Ñ–∞–π–ª
    function downloadJSON(data, filename) {
      var blob = new Blob([data], {type: 'application/json'});
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É —Ñ–∞–π–ª
    document.getElementById('save').onclick = function() {
      var geojson = drawnItems.toGeoJSON();
      var jsonString = JSON.stringify(geojson, null, 2);
      downloadJSON(jsonString, 'zones.json');
      alert('–§–∞–π–ª zones.json –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
    };
  </script>
</body>
</html>
